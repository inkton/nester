#!/usr/bin/env python
# -*- coding: utf-8 -*-
#  Copyright (C) Inkton 2016 <thebird@nest.yt>
#
## -*- python -*-
# vim: tabstop=8 expandtab shiftwidth=4 softtabstop=4

import errno, os, sys
import argparse

from datetime import datetime, date, time
from subprocess import Popen, PIPE, STDOUT

from thing import Thing

class Test(Thing):

    def __init__(self, thing):
        self._thing = thing

    def parse_command(self, subparsers):
        cmd_parser = subparsers.add_parser('test', help='Manage the test app')
        app_cmd_parsers = cmd_parser.add_subparsers(dest='test_command', help='test commands')

        app_cmd_parsers.add_parser('run', help='Run the test app')
        #pull_cmd = app_cmd_parsers.add_parser('pull', help='Pull content from the remote live site')
        #pull_cmd.add_argument('-t', '--timeout', type=int, default=30, required=False, help='The timeout')

    def exec_command(self, args):
        self.set_log(args.log)
        cmd_handled = False
        if args.command == 'test':
            self.log("handle test command")
            cmd_handled = True
            if (args.content_command == 'run'):
               self.run()
            else:
                cmd_handled = False
            self.end_cmd()
        return cmd_handled
   
    def run(self, timeout):
	self.log("run test")
        self.os_exec("/usr/bin/rsync -avzrh --timeout=" + str(timeout) + " --progress /var/app nest:/var")

